<app-navbar></app-navbar>

<ion-content>
  <div class="home-container">
    <div class="section-header">
      <h1>Nossos Produtos</h1>
      <p>Encontre os melhores produtos com os melhores preços</p>
    </div>
    
    <div *ngIf="carregando" class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Carregando produtos...</p>
    </div>
    
    <!-- Indicador de busca -->
    <div *ngIf="buscando" class="searching-indicator">
      <ion-spinner name="crescent" class="search-spinner"></ion-spinner>
      <span>Buscando produtos...</span>
    </div>

    <div *ngIf="!carregando && produtosFiltrados.length === 0" class="empty-state">
      <ion-icon name="search-outline"></ion-icon>
      <h2>Nenhum produto encontrado</h2>
      <p *ngIf="produtos.length > 0">Não encontramos produtos que correspondam à sua busca.</p>
      <p *ngIf="produtos.length === 0">Não conseguimos carregar os produtos no momento.</p>
      <ion-button (click)="carregarProdutos()" fill="clear">
        <ion-icon slot="start" name="refresh"></ion-icon>
        {{ produtos.length > 0 ? 'Limpar busca' : 'Tentar novamente' }}
      </ion-button>
    </div>

    <div class="products-grid" [class.filtering]="buscando">
      <ion-card 
        *ngFor="let produto of produtosFiltrados" 
        class="product-card" 
        (click)="verDetalhes(produto.id)"
        appPromocao
        [emPromocao]="produto.price < 100">
        <div class="product-image">
          <img [src]="produto.image" [alt]="produto.title" />
        </div>
        <ion-card-header>
          <ion-card-title>{{ produto.title | slice:0:30 }}{{ produto.title.length > 30 ? '...' : '' }}</ion-card-title>
          <ion-card-subtitle>{{ produto.category }}</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <div class="product-price">
            <span class="price">{{ produto.price | currency:'BRL':'symbol':'1.2-2' }}</span>
            <ion-button 
              size="small" 
              color="primary" 
              (click)="$event.stopPropagation(); adicionarAoCarrinho(produto)">
              <ion-icon name="cart" slot="icon-only"></ion-icon>
            </ion-button>
          </div>
          <p class="product-description">
            {{ produto.description | slice:0:100 }}{{ produto.description.length > 100 ? '...' : '' }}
          </p>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>