<app-navbar></app-navbar>

<ion-content>
  <div class="home-container">
    <div class="section-header">
      <h1>Nossos Produtos</h1>
      <p>Encontre os melhores produtos com os melhores preços</p>
    </div>
    
    <div *ngIf="carregando" class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Carregando produtos...</p>
    </div>
    
    <!-- Indicador de busca -->
    <div *ngIf="buscando" class="searching-indicator">
      <ion-spinner name="crescent" class="search-spinner"></ion-spinner>
      <span>Buscando produtos...</span>
    </div>

    <div *ngIf="!carregando && produtosFiltrados.length === 0" class="empty-state">
      <ion-icon name="search-outline"></ion-icon>
      <h2>Nenhum produto encontrado</h2>
      <p *ngIf="produtos.length > 0">Não encontramos produtos que correspondam à sua busca.</p>
      <p *ngIf="produtos.length === 0">Não conseguimos carregar os produtos no momento.</p>
      <ion-button (click)="carregarProdutos()" fill="clear">
        <ion-icon slot="start" name="refresh"></ion-icon>
        {{ produtos.length > 0 ? 'Limpar busca' : 'Tentar novamente' }}
      </ion-button>
    </div>

    <div class="products-grid" [class.filtering]="buscando">
      <ion-card *ngFor="let produto of produtosFiltrados" class="product-card" (click)="verDetalhes(produto.id)">
        <div class="product-image">
          <img [src]="produto.image" [alt]="produto.title" />
        </div>
        
        <div class="product-info">
          <span class="product-category">{{ produto.category }}</span>
          <h2 class="product-title">{{ produto.title }}</h2>
          
          <div class="product-price">{{ produto.price | number:'1.2-2' }}</div>
          
          <div class="product-rating">
            <div class="stars">
              <ion-icon *ngFor="let star of [1,2,3,4,5]" 
                       [name]="getStarIcon(star, produto.rating.rate)"></ion-icon>
            </div>
            <span class="rating-value">{{ produto.rating.rate | number:'1.1-1' }}</span>
            <span class="rating-count">({{ produto.rating.count }})</span>
          </div>
          
          <ion-button expand="block" color="primary" (click)="$event.stopPropagation(); adicionarAoCarrinho(produto)">
            <ion-icon name="cart" slot="start"></ion-icon>
            Adicionar ao Carrinho
          </ion-button>
        </div>
      </ion-card>
    </div>
  </div>
</ion-content>